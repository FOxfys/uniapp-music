if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then(a=>t.resolve(e()).then(()=>a),a=>t.resolve(e()).then(()=>{throw a}))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}const a=(t,a=0)=>(a,l=e.getCurrentInstance())=>{!e.isInSSRComponentSetup&&e.injectHook(t,a,l)},l=a("onShow",3),n=a("onHide",3),o=a("onLaunch",1),s=a("onLoad",2),i=a("onUnload",2),r=a("onReachBottom",2),c=e=>new Promise((a,l)=>{const n={Cookie:uni.getStorageSync("session_cookie")||"",...e.header};e.method&&"POST"===e.method.toUpperCase()?"/user/login"===e.url||"/user/register"===e.url?n["Content-Type"]="application/x-www-form-urlencoded":n["Content-Type"]="application/json":e.method&&e.method.toUpperCase(),t("log","at api/request.js:26",`[Request] ${e.method||"GET"} ${e.url}`,{data:e.data,header:n}),uni.request({url:"https://music.686909.xyz"+e.url,method:e.method||"GET",data:e.data||{},header:n,success:n=>{t("log","at api/request.js:34",`[Response] ${n.statusCode}`,n.data);let o=n.header["Set-Cookie"]||n.header["set-cookie"];if(o&&(Array.isArray(o)&&(o=o.join("; ")),uni.setStorageSync("session_cookie",o),t("log","at api/request.js:42","Cookie saved:",o)),"string"==typeof n.data)return t("warn","at api/request.js:46","Received string response (likely HTML):",n.data.substring(0,100)),e.url.includes("logout")?void a({code:200,message:"Logged out"}):(uni.showToast({title:"ÁôªÂΩïÂ∑≤ËøáÊúüÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï",icon:"none"}),uni.removeStorageSync("userInfo"),uni.removeStorageSync("session_cookie"),uni.navigateTo({url:"/pages/login/login"}),void l(n.data));if(n.statusCode>=200&&n.statusCode<300){const e=n.data||{};"object"==typeof e&&(void 0===e.code&&void 0===e.status&&(e.code=200),200===e.status&&(e.code=200)),a(e)}else 401===n.statusCode?(uni.showToast({title:"ËØ∑ÂÖàÁôªÂΩï",icon:"none"}),uni.navigateTo({url:"/pages/login/login"}),l(n.data)):(uni.showToast({title:n.data.message||`ÈîôËØØ ${n.statusCode}`,icon:"none"}),l(n.data))},fail:e=>{t("error","at api/request.js:83","[Request Fail]",e),uni.showToast({title:"ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•",icon:"none"}),l(e)}})}),u=uni.getStorageSync("userInfo")||{},d=Object.keys(u).length>0,m=e.reactive({isLoggedIn:d,userInfo:u,setLoginState(e){this.isLoggedIn=!0,this.userInfo={...this.userInfo,...e},uni.setStorageSync("userInfo",this.userInfo),t("log","at store/user.js:17","User state updated:",this.userInfo)},async fetchUserInfo(){try{const e=await c({url:"/user/get_user_info",method:"GET"}),t=e.data||e;if(t&&t.id)return this.setLoginState(t),t}catch(e){t("error","at store/user.js:34","Fetch user info failed:",e)}return null},async logout(){try{await c({url:"/user/logout",method:"GET"})}catch(e){t("error","at store/user.js:43","Logout API failed:",e)}finally{this.isLoggedIn=!1,this.userInfo={},uni.removeStorageSync("userInfo"),uni.removeStorageSync("loginHistory"),uni.removeStorageSync("session_cookie"),t("log","at store/user.js:50","User logged out")}}}),p=()=>c({url:"/user/playlists",method:"GET"}),v=e=>c({url:"/user/create_playlist",method:"POST",data:e}),g=(e,t)=>c({url:`/user/playlist/${e}/add_song`,method:"POST",data:t}),y=uni.getBackgroundAudioManager(),h=uni.getSystemInfoSync(),w=h.windowWidth,E=h.windowHeight,V=e.reactive({isPlaying:!1,currentSong:null,playlist:[],currentTime:0,duration:0,playMode:"sequence",widgetPosition:{x:w-80,y:E-150},togglePlayMode(){const e=["sequence","loop","random"],t=e.indexOf(this.playMode);this.playMode=e[(t+1)%e.length];let a="È°∫Â∫èÊí≠Êîæ";"loop"===this.playMode&&(a="ÂçïÊõ≤Âæ™ÁéØ"),"random"===this.playMode&&(a="ÈöèÊú∫Êí≠Êîæ"),uni.showToast({title:a,icon:"none"})},async setSongAndPlay(e){if(e)if(this.currentTime=0,this.duration=0,this.currentSong=e,this.isPlaying=!1,!this.currentSong.ar&&this.currentSong.artists&&(this.currentSong.ar=this.currentSong.artists),!this.currentSong.al&&this.currentSong.album&&(this.currentSong.al=this.currentSong.album),this.currentSong.url)this._playAudio(this.currentSong.url);else{uni.showLoading({title:"Âä†ËΩΩÈü≥È¢ë..."});try{const e=await(a=this.currentSong.id,c({url:`/music/song/url/${a}`,method:"GET"}));e.data&&e.data.url?this._playAudio(e.data.url):uni.showToast({title:"Êó†Ê≥ïËé∑ÂèñÊí≠ÊîæÂú∞ÂùÄ",icon:"none"})}catch(l){t("error","at store/player.js:65",l),uni.showToast({title:"Êí≠ÊîæÂá∫Èîô",icon:"none"})}finally{uni.hideLoading()}var a}},_playAudio(e){y.src=e,y.title=this.currentSong.name||"Êú™Áü•Ê≠åÊõ≤";let a="Êú™Áü•Ê≠åÊâã";this.currentSong.ar_name?a=this.currentSong.ar_name:this.currentSong.ar&&(a=this.currentSong.ar.map(e=>e.name).join("/")),y.singer=a;let l="";var n;this.currentSong.pic?l=this.currentSong.pic:this.currentSong.al&&(l=this.currentSong.al.picUrl),y.coverImgUrl=l,m.isLoggedIn&&(n={song_id:this.currentSong.id},c({url:"/user/save_history",method:"POST",data:n})).catch(e=>t("error","at store/player.js:97","Save history failed:",e))},play(){this.currentSong&&y.src?y.play():this.currentSong&&this.setSongAndPlay(this.currentSong)},pause(){y.pause()},seek(e){this.duration>0&&y.seek(e)},playNext(e=!1){if(0===this.playlist.length)return;if("loop"===this.playMode&&e)return void this.setSongAndPlay(this.currentSong);if("random"===this.playMode){const e=Math.floor(Math.random()*this.playlist.length);return void this.setSongAndPlay(this.playlist[e])}const t=this.playlist.findIndex(e=>{var t;return e.id===(null==(t=this.currentSong)?void 0:t.id)});let a=0;-1!==t&&(a=(t+1)%this.playlist.length),this.setSongAndPlay(this.playlist[a])},playPrev(){if(0===this.playlist.length)return;if("random"===this.playMode){const e=Math.floor(Math.random()*this.playlist.length);return void this.setSongAndPlay(this.playlist[e])}const e=this.playlist.findIndex(e=>{var t;return e.id===(null==(t=this.currentSong)?void 0:t.id)});let t=0;-1!==e&&(t=(e-1+this.playlist.length)%this.playlist.length),this.setSongAndPlay(this.playlist[t])},setPlaylist(e){this.playlist=JSON.parse(JSON.stringify(e))},updateWidgetPosition(e,t){this.widgetPosition.x=e,this.widgetPosition.y=t}});y.onPlay(()=>V.isPlaying=!0),y.onPause(()=>V.isPlaying=!1),y.onStop(()=>{V.isPlaying=!1,V.currentTime=0}),y.onEnded(()=>V.playNext(!0)),y.onTimeUpdate(()=>{V.currentTime=y.currentTime,y.duration&&V.duration!==y.duration&&(V.duration=y.duration)}),y.onError(e=>{t("error","at store/player.js:178","Audio Error:",e),V.isPlaying=!1,uni.showToast({title:"Èü≥È¢ëÊí≠ÊîæÈîôËØØ",icon:"none"})}),y.onCanplay(()=>{y.duration&&(V.duration=y.duration)});const N=(e,t)=>{const a=e.__vccOpts||e;for(const[l,n]of t)a[l]=n;return a},k=N({__name:"MusicPlayerWidget",setup(a){const l=e.reactive({x:V.widgetPosition.x,y:V.widgetPosition.y}),n=e.computed(()=>{var e;const t=V.currentSong;return t&&((null==(e=t.al)?void 0:e.picUrl)||t.cover_url||t.picUrl)||"/static/default-avatar.png"}),o=e.reactive({x:0,y:0});let s=!1,i=0,r=0;const c=e=>{i=e.touches[0].clientX,r=e.touches[0].clientY,o.x=i-l.x,o.y=r-l.y,s=!1},u=e=>{const t=e.touches[0].clientX,a=e.touches[0].clientY;(Math.abs(t-i)>5||Math.abs(a-r)>5)&&(s=!0,l.x=t-o.x,l.y=a-o.y)},d=()=>{s&&V.updateWidgetPosition(l.x,l.y)},m=()=>{s||uni.navigateTo({url:"/pages/player/player",fail:e=>{t("error","at components/MusicPlayerWidget.vue:78","Navigation failed:",e)}})};return(t,a)=>e.unref(V).currentSong?(e.openBlock(),e.createElementBlock("view",{key:0,class:"widget-container",style:e.normalizeStyle({left:l.x+"px",top:l.y+"px"}),onTouchstart:c,onTouchmove:e.withModifiers(u,["stop","prevent"]),onTouchend:d,onClick:e.withModifiers(m,["stop"])},[e.createElementVNode("view",{class:e.normalizeClass(["glow-ring",{playing:e.unref(V).isPlaying}])},null,2),e.createElementVNode("image",{src:n.value,class:e.normalizeClass(["cover-image",{playing:e.unref(V).isPlaying}]),mode:"aspectFill"},null,10,["src"])],36)):e.createCommentVNode("",!0)}},[["__scopeId","data-v-6993cc0e"]]),f=N({__name:"index",setup(a){const l=e.ref([]),n=e.ref([]),o=e.ref(1),s=e.ref(!1),i=e.ref(0),u=e.computed(()=>n.value.slice(0,9*o.value)),d=async()=>{try{const e=await c({url:"/music/hot_playlists",method:"GET"});if(e.playlists){const t=e.playlists.map(e=>{let t=e.coverImgUrl||e.picUrl||"";return t&&t.startsWith("http://")&&(t=t.replace("http://","https://")),{id:e.id,name:e.name,picUrl:t}});l.value=t.slice(0,5),n.value=t.slice(5)}}catch(e){t("error","at pages/index/index.vue:140","Failed to fetch hot playlists:",e),uni.showToast({title:"È¶ñÈ°µÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•",icon:"none"})}};r(()=>{s.value||u.value.length>=n.value.length||(s.value=!0,setTimeout(()=>{o.value++,s.value=!1},500))});const p=e=>{i.value=e.detail.current},v=(e,t)=>{e.picUrl="/static/rank/original.png"},g=()=>{m.isLoggedIn?uni.switchTab({url:"/pages/my/my"}):uni.navigateTo({url:"/pages/login/login"})},y=()=>{uni.navigateTo({url:"/pages/search/search"})};return e.onMounted(()=>{setTimeout(()=>{d()},500)}),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"home-container"},[e.createElementVNode("view",{class:"bg-gradient"}),e.createElementVNode("view",{class:"bg-noise"}),e.createElementVNode("view",{class:"top-bar"},[e.createElementVNode("view",{class:"user-status",onClick:g},[e.createElementVNode("view",{class:"avatar-box"},[e.createElementVNode("view",{class:"avatar-ring"}),e.createElementVNode("image",{class:"avatar",src:e.unref(m).isLoggedIn&&e.unref(m).userInfo.avatarUrl||"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"])]),e.unref(m).isLoggedIn?(e.openBlock(),e.createElementBlock("view",{key:0,class:"user-info"},[e.createElementVNode("text",{class:"nickname"},e.toDisplayString(e.unref(m).userInfo.username),1),e.createElementVNode("view",{class:"badge"},"MUSICIAN")])):(e.openBlock(),e.createElementBlock("text",{key:1,class:"nickname"},"Êú™ÁôªÂΩï"))]),e.createElementVNode("view",{class:"search-bar",onClick:y},[e.createElementVNode("view",{class:"search-input-mock"},[e.createElementVNode("view",{class:"search-icon-box"},[e.createElementVNode("view",{class:"icon-search"})]),e.createElementVNode("text",{class:"placeholder"},"ÊêúÁ¥¢Ê≠åÊõ≤„ÄÅÊ≠åÊâã..."),e.createElementVNode("view",{class:"scan-line"})])])]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"scroll-content",onScrolltolower:a[0]||(a[0]=(...t)=>e.unref(r)&&e.unref(r)(...t))},[e.createElementVNode("swiper",{class:"banner-swiper",circular:"",interval:"4000",duration:"500","previous-margin":"50rpx","next-margin":"50rpx",onChange:p},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,(t,a)=>(e.openBlock(),e.createElementBlock("swiper-item",{key:t.id},[e.createElementVNode("view",{class:e.normalizeClass(["banner-item",{active:i.value===a}])},[e.createElementVNode("image",{src:t.picUrl,mode:"aspectFill",class:"banner-image",onError:e=>v(t)},null,40,["src","onError"]),e.createElementVNode("view",{class:"banner-mask"}),e.createElementVNode("text",{class:"banner-title"},e.toDisplayString(t.name),1)],2)]))),128))],32),e.createElementVNode("view",{class:"playlist-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"RECOMMEND"),e.createElementVNode("text",{class:"section-subtitle"},"‰∏∫‰Ω†Êé®Ëçê")]),e.createElementVNode("view",{class:"playlist-grid"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"playlist-card",key:t.id,onClick:e=>{return a=t.id,void uni.navigateTo({url:`/pages/playlist/detail?id=${a}`});var a},style:e.normalizeStyle({animationDelay:.05*a+"s"})},[e.createElementVNode("view",{class:"card-image-wrapper"},[e.createElementVNode("image",{src:t.picUrl,mode:"aspectFill",class:"playlist-cover","lazy-load":"",onError:e=>v(t)},null,40,["src","onError"]),e.createElementVNode("view",{class:"play-icon"},"‚ñ∂")]),e.createElementVNode("text",{class:"playlist-name"},e.toDisplayString(t.name),1)],12,["onClick"]))),128))]),s.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-more"},[e.createElementVNode("view",{class:"loading-dot"}),e.createElementVNode("view",{class:"loading-dot"}),e.createElementVNode("view",{class:"loading-dot"})])):e.createCommentVNode("",!0)])],32),e.createVNode(k)]))}},[["__scopeId","data-v-6e91c5ab"]]),S=N({__name:"rank",setup(t){l(()=>{setTimeout(()=>{uni.showTabBar({animation:!0})},200)});const a=e.ref([{id:3778678,name:"ÁÉ≠Ê≠åÊ¶ú",styleClass:"hot"},{id:19723756,name:"È£ôÂçáÊ¶ú",styleClass:"soar"},{id:3779629,name:"Êñ∞Ê≠åÊ¶ú",styleClass:"new"},{id:2884035,name:"ÂéüÂàõÊ¶ú",styleClass:"original"}]);return(t,l)=>(e.openBlock(),e.createElementBlock("view",{class:"rank-container"},[e.createElementVNode("view",{class:"bg-gradient"}),e.createElementVNode("view",{class:"bg-noise"}),e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"page-title"},"ÊéíË°åÊ¶ú"),e.createElementVNode("text",{class:"page-subtitle"},"TOP CHARTS")]),e.createElementVNode("view",{class:"rank-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["rank-card",t.styleClass]),key:t.id,onClick:e=>{return a=t.id,void uni.navigateTo({url:`/pages/playlist/detail?id=${a}`});var a},style:e.normalizeStyle({animationDelay:.1*a+"s"})},[e.createElementVNode("view",{class:"card-border"}),e.createElementVNode("view",{class:"card-corner top-left"}),e.createElementVNode("view",{class:"card-corner top-right"}),e.createElementVNode("view",{class:"card-corner bottom-left"}),e.createElementVNode("view",{class:"card-corner bottom-right"}),e.createElementVNode("view",{class:"card-content"},[e.createElementVNode("text",{class:"rank-name"},e.toDisplayString(t.name),1)])],14,["onClick"]))),128))]),e.createVNode(k)]))}},[["__scopeId","data-v-9a4cd156"]]),x=N({__name:"parse",setup(a){l(()=>{setTimeout(()=>{uni.showTabBar({animation:!0})},200)});const n=e.ref(""),o=e.ref("playlist"),s=()=>{uni.getClipboardData({success:e=>{n.value=e.data,e.data.includes("playlist")?o.value="playlist":e.data.includes("song")&&(o.value="song"),uni.showToast({title:"Â∑≤Á≤òË¥¥",icon:"none"})}})},i=async()=>{const e=n.value.trim();if(!e)return void uni.showToast({title:"ËØ∑ËæìÂÖ•ÂÜÖÂÆπ",icon:"none"});const a=(e=>{const t=e.match(/id=(\d+)/);if(t)return t[1];const a=e.match(/\/playlist\/(\d+)/);if(a)return a[1];const l=e.match(/\/song\/(\d+)/);return l?l[1]:/^\d+$/.test(e)?e:null})(e);var l;if(a)if("playlist"===o.value)uni.navigateTo({url:`/pages/playlist/detail?id=${a}&type=music`});else{uni.showLoading({title:"Ëß£Êûê‰∏≠..."});try{const e=await(l={ids:a,level:"standard",type:"json"},c({url:"/music/jx",method:"GET",data:l}));if(200===e.status){const t={id:a,name:e.name,url:e.url,ar:[{name:e.ar_name}],al:{name:e.al_name,picUrl:e.pic},picUrl:e.pic,artist:e.ar_name,album:e.al_name};V.setSongAndPlay(t),uni.navigateTo({url:"/pages/player/player"})}else uni.showToast({title:e.message||"Ëß£ÊûêÂ§±Ë¥•",icon:"none"})}catch(s){t("error","at pages/parse/parse.vue:149",s),uni.showToast({title:"Ëß£ÊûêËØ∑Ê±ÇÂ§±Ë¥•",icon:"none"})}finally{uni.hideLoading()}}else uni.showToast({title:"Êó†Ê≥ïËØÜÂà´ID",icon:"none"})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"parse-container"},[e.createElementVNode("view",{class:"bg-gradient"}),e.createElementVNode("view",{class:"bg-noise"}),e.createElementVNode("view",{class:"content-wrapper"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("text",{class:"main-title"},"DATA PORT"),e.createElementVNode("text",{class:"sub-title"},"Èü≥‰πêÊï∞ÊçÆËß£ÊûêÁ´ØÂè£")]),e.createElementVNode("view",{class:"input-core"},[e.createElementVNode("view",{class:"core-glow"}),e.withDirectives(e.createElementVNode("textarea",{class:"parse-textarea",placeholder:"Á≤òË¥¥ÈìæÊé•ÊàñËæìÂÖ•ID...","onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),maxlength:"-1"},null,512),[[e.vModelText,n.value]]),e.createElementVNode("view",{class:"btn-group"},[e.createElementVNode("text",{class:"action-btn paste",onClick:s},"Á≤òË¥¥"),n.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"action-btn clear",onClick:a[1]||(a[1]=e=>n.value="")},"Ê∏ÖÁ©∫")):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"type-selector"},[e.createElementVNode("view",{class:e.normalizeClass(["type-item",{active:"song"===o.value}]),onClick:a[2]||(a[2]=e=>o.value="song")},[e.createElementVNode("text",null,"ÂçïÊõ≤")],2),e.createElementVNode("view",{class:e.normalizeClass(["type-item",{active:"playlist"===o.value}]),onClick:a[3]||(a[3]=e=>o.value="playlist")},[e.createElementVNode("text",null,"Ê≠åÂçï")],2)]),e.createElementVNode("view",{class:"parse-btn-wrapper"},[e.createElementVNode("button",{class:"parse-btn",onClick:i},[e.createElementVNode("text",null,"ÂºÄÂßãËß£Êûê")])])]),e.createVNode(k)]))}},[["__scopeId","data-v-cd1ec9c6"]]),b=N({__name:"my",setup(a){const n=e.ref(!1),o=e.ref(""),s=e.ref(""),i=e.ref(""),r=e.ref([]);l(()=>{m.isLoggedIn?u():r.value=[]});const u=async()=>{try{const e=await p();200===e.code&&e.playlists&&(r.value=e.playlists)}catch(e){t("error","at pages/my/my.vue:126","Fetch playlists failed:",e)}},d=()=>!!m.isLoggedIn||(uni.showToast({title:"ËØ∑ÂÖàÁôªÂΩï",icon:"none",complete:()=>{setTimeout(()=>{uni.navigateTo({url:"/pages/login/login"})},1500)}}),!1),g=()=>{d()&&uni.navigateTo({url:"/pages/my/history"})},y=()=>{d()&&(n.value=!0,o.value="",s.value="",i.value="")},h=()=>{uni.chooseImage({count:1,sizeType:["compressed"],success:e=>{const a=e.tempFilePaths[0];uni.getFileSystemManager().readFile({filePath:a,encoding:"base64",success:e=>{const t="data:image/jpeg;base64,"+e.data;i.value=t},fail:e=>{t("error","at pages/my/my.vue:176","Read file failed:",e),uni.showToast({title:"ÂõæÁâáËØªÂèñÂ§±Ë¥•",icon:"none"})}})}})},w=async()=>{if(o.value.trim()){uni.showLoading({title:"ÂàõÂª∫‰∏≠..."});try{const e={name:o.value,description:s.value,cover_url:i.value||""},t=await v(e);200===t.code?(uni.showToast({title:"ÂàõÂª∫ÊàêÂäü",icon:"success"}),n.value=!1,u()):uni.showToast({title:t.message||"ÂàõÂª∫Â§±Ë¥•",icon:"none"})}catch(e){e&&e.message&&e.message.includes("ÂàõÂª∫Â§±Ë¥•")?uni.showToast({title:"Ê≠åÂçïÂêçÁß∞ÂèØËÉΩÂ∑≤Ë¢´‰ΩøÁî®",icon:"none",duration:2e3}):uni.showToast({title:"ËØ∑Ê±ÇÂ§±Ë¥•",icon:"none"}),t("error","at pages/my/my.vue:212",e)}finally{uni.hideLoading()}}else uni.showToast({title:"ËØ∑ËæìÂÖ•ÂêçÁß∞",icon:"none"})},E=e=>{uni.showActionSheet({itemList:["Âà†Èô§Ê≠åÂçï"],itemColor:"#ff5555",success:a=>{0===a.tapIndex&&uni.showModal({title:"Á°ÆËÆ§Âà†Èô§",content:`Á°ÆÂÆöË¶ÅÂà†Èô§Ê≠åÂçï "${e.name}" ÂêóÔºü`,success:async a=>{if(a.confirm)try{const t=await(l=e.id,c({url:`/user/playlist/${l}`,method:"DELETE"}));200===t.code?(uni.showToast({title:"Âà†Èô§ÊàêÂäü",icon:"success"}),u()):uni.showToast({title:t.message||"Âà†Èô§Â§±Ë¥•",icon:"none"})}catch(n){t("error","at pages/my/my.vue:238",n)}var l}})}})},V=()=>{uni.navigateTo({url:"/pages/about/about"})},N=()=>{m.isLoggedIn||uni.navigateTo({url:"/pages/login/login"})},f=()=>{uni.showModal({title:"ÊèêÁ§∫",content:"Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü",success:e=>{e.confirm&&(m.logout(),r.value=[],uni.showToast({title:"Â∑≤ÈÄÄÂá∫",icon:"none"}))}})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"my-container"},[e.createElementVNode("view",{class:"bg-gradient"}),e.createElementVNode("view",{class:"bg-noise"}),e.createElementVNode("view",{class:"user-card",onClick:N},[e.createElementVNode("view",{class:"avatar-wrapper"},[e.createElementVNode("image",{class:"avatar",src:e.unref(m).isLoggedIn&&e.unref(m).userInfo.avatarUrl||"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"avatar-glow"})]),e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("text",{class:"nickname"},e.toDisplayString(e.unref(m).isLoggedIn?e.unref(m).userInfo.username:"ÁÇπÂáªÁôªÂΩï"),1),e.unref(m).isLoggedIn?(e.openBlock(),e.createElementBlock("text",{key:0,class:"user-desc"},"Èü≥‰πêËÆ©ÁîüÊ¥ªÊõ¥ÁæéÂ•Ω")):(e.openBlock(),e.createElementBlock("text",{key:1,class:"user-desc"},"ÁôªÂΩïÂêåÊ≠•‰Ω†ÁöÑÈü≥‰πê‰∏ñÁïå"))])]),e.createElementVNode("view",{class:"action-grid"},[e.createElementVNode("view",{class:"action-item",onClick:g},[e.createElementVNode("view",{class:"icon-box history-icon"},"üïí"),e.createElementVNode("text",{class:"action-text"},"Êí≠ÊîæÂéÜÂè≤")]),e.createElementVNode("view",{class:"action-item",onClick:y},[e.createElementVNode("view",{class:"icon-box create-icon"},"‚ûï"),e.createElementVNode("text",{class:"action-text"},"ÂàõÂª∫Ê≠åÂçï")]),e.createElementVNode("view",{class:"action-item",onClick:V},[e.createElementVNode("view",{class:"icon-box about-icon"},"‚ÑπÔ∏è"),e.createElementVNode("text",{class:"action-text"},"ÂÖ≥‰∫éÊàë‰ª¨")]),e.unref(m).isLoggedIn?(e.openBlock(),e.createElementBlock("view",{key:0,class:"action-item",onClick:f},[e.createElementVNode("view",{class:"icon-box logout-icon"},"üö™"),e.createElementVNode("text",{class:"action-text"},"ÈÄÄÂá∫ÁôªÂΩï")])):e.createCommentVNode("",!0)]),e.unref(m).isLoggedIn?(e.openBlock(),e.createElementBlock("view",{key:0,class:"playlist-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"ÊàëÁöÑÊ≠åÂçï"),e.createElementVNode("text",{class:"playlist-count"},e.toDisplayString(r.value.length)+" ‰∏™",1)]),e.createElementVNode("view",{class:"playlist-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"playlist-card",key:t.id,onClick:e=>{return a=t.id,void uni.navigateTo({url:`/pages/playlist/detail?id=${a}&type=user`});var a},onLongpress:e=>E(t),style:e.normalizeStyle({animationDelay:.05*a+"s"})},[e.createElementVNode("image",{src:t.cover_url||"/static/default-avatar.png",class:"playlist-cover",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"playlist-info"},[e.createElementVNode("text",{class:"playlist-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"playlist-meta"},e.toDisplayString(t.song_count||0)+" È¶ñÊ≠åÊõ≤",1)])],44,["onClick","onLongpress"]))),128))])])):e.createCommentVNode("",!0),n.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"modal-mask"},[e.createElementVNode("view",{class:"modal-content"},[e.createElementVNode("text",{class:"modal-title"},"Êñ∞Âª∫Ê≠åÂçï"),e.createElementVNode("view",{class:"cover-upload-section"},[e.createElementVNode("view",{class:"cover-preview",onClick:h},[e.createElementVNode("image",{src:i.value||"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"upload-tip"},"ÁÇπÂáªÊõ¥Êç¢Â∞ÅÈù¢")])]),e.withDirectives(e.createElementVNode("input",{class:"modal-input","onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),placeholder:"Ê≠åÂçïÊ†áÈ¢ò (ÂøÖÂ°´)"},null,512),[[e.vModelText,o.value]]),e.withDirectives(e.createElementVNode("textarea",{class:"modal-textarea","onUpdate:modelValue":a[1]||(a[1]=e=>s.value=e),placeholder:"Ê≠åÂçïÊèèËø∞ (ÈÄâÂ°´)"},null,512),[[e.vModelText,s.value]]),e.createElementVNode("view",{class:"modal-btns"},[e.createElementVNode("text",{class:"modal-btn cancel",onClick:a[2]||(a[2]=e=>n.value=!1)},"ÂèñÊ∂à"),e.createElementVNode("text",{class:"modal-btn confirm",onClick:w},"Êèê‰∫§")])])])):e.createCommentVNode("",!0),e.createVNode(k)]))}},[["__scopeId","data-v-907df969"]]);const B=N({},[["render",function(t,a){return e.openBlock(),e.createElementBlock("view",{class:"about-container"},[e.createElementVNode("h1",{class:"title"},"ÂÖ≥‰∫éÊàë‰ª¨"),e.createElementVNode("view",{class:"content"},[e.createElementVNode("text",{class:"paragraph"}," ËøôÊòØ‰∏ÄÊ¨æÊ®°‰ªøÁΩëÊòì‰∫ëÈü≥‰πêÁöÑÂæÆ‰ø°Â∞èÁ®ãÂ∫èÔºåÊó®Âú®Êèê‰æõÊµÅÁïÖÁöÑÈü≥‰πê‰ΩìÈ™åÂíå‰æøÊç∑ÁöÑÈü≥‰πêËß£ÊûêÂäüËÉΩ„ÄÇ "),e.createElementVNode("text",{class:"paragraph"}," È°πÁõÆÂü∫‰∫é UniApp Âíå Vue 3 ÂºÄÂèëÔºåÂêéÁ´ØÊúçÂä°Áî± Flask Âº∫ÂäõÈ©±Âä®„ÄÇ "),e.createElementVNode("h2",{class:"subtitle"},"Ê∏©È¶®ÊèêÁ§∫"),e.createElementVNode("text",{class:"paragraph"}," 1. Êú¨È°πÁõÆ‰ªÖ‰æõÂ≠¶‰π†ÂíåÊäÄÊúØ‰∫§ÊµÅ‰ΩøÁî®ÔºåËØ∑ÂãøÁî®‰∫éÂïÜ‰∏öÁî®ÈÄî„ÄÇ "),e.createElementVNode("text",{class:"paragraph"}," 2. ÊâÄÊúâÈü≥‰πêËµÑÊ∫êÁâàÊùÉÂΩíÂéü‰ΩúËÄÖÊâÄÊúâÔºåËØ∑ÊîØÊåÅÊ≠£ÁâàÈü≥‰πê„ÄÇ ")])])}],["__scopeId","data-v-b8327108"]]),T=N({__name:"detail",setup(a){const l=e.ref({}),n=e.ref([]),o=e.ref("music"),i=e.ref(null),r=e.ref(!1),u=e.ref(0),d=e.ref(0),m=e.ref(1),p=e.ref(1),y=e.ref(0),h=e.ref(!1),w=e.ref(0),E=e.ref("");s(async e=>{const a=e.id;if(i.value=a,o.value=e.type||"music",a){uni.showLoading({title:"Âä†ËΩΩ‰∏≠..."});try{let e;"user"===o.value?(e=await(r=a,c({url:`/user/playlist/${r}`,method:"GET"})),200===e.code&&e.playlist&&(l.value={name:e.playlist.name,description:e.playlist.description,coverImgUrl:e.playlist.cover_url||"/static/rank/original.png",creator:{nickname:"Êàë"}},n.value=(e.songs||[]).map(f))):(e=await(s=a,c({url:`/music/playlist/${s}`,method:"GET"})),200===e.code&&e.result&&(l.value=e.result,n.value=(e.result.tracks||[]).map(f)))}catch(u){t("error","at pages/playlist/detail.vue:171",u)}finally{uni.hideLoading()}}var s,r});const N=e=>{const t=e.detail.scrollTop,a=100;u.value=Math.min(t/a,1),d.value=Math.min(Math.max(0,t-a)/50,1);const l=Math.max(1-t/200,.8);m.value=l,p.value=Math.max(1-t/a,0),y.value=.3*t},f=e=>{let t=e.name||e.song_name||"Êú™Áü•Ê≠åÊõ≤",a=e.id||e.song_id,l="Êú™Áü•Ê≠åÊâã",n="Êú™Áü•‰∏ìËæë",o=e.cover_url||"";return e.artist?l=e.artist:e.ar&&Array.isArray(e.ar)?l=e.ar.map(e=>e.name).join("/"):e.artists&&Array.isArray(e.artists)&&(l=e.artists.map(e=>e.name).join("/")),e.album&&"string"==typeof e.album?n=e.album:e.al&&e.al.name?(n=e.al.name,o=e.al.picUrl):e.album&&"object"==typeof e.album&&(n=e.album.name),!o&&e.al&&(o=e.al.picUrl),{id:a,name:t,artistStr:l,albumStr:n,picUrl:o,original:e}},S=async()=>{if(0!==n.value.length){h.value=!0,E.value="Ê≠£Âú®ÂàõÂª∫Êñ∞Ê≠åÂçï...",w.value=0;try{const a={name:l.value.name,description:l.value.description||"",cover_url:l.value.coverImgUrl||""},o=await v(a);if(200!==o.code)throw new Error(o.message);const s=o.playlist_id,i=10;let r=0;for(let e=0;e<n.value.length;e+=i){const t=n.value.slice(e,e+i),a=t.map(e=>g(s,{song_id:e.id}));await Promise.all(a),r+=t.length,E.value=`Ê≠£Âú®Ê∑ªÂä†: ${r} / ${n.value.length}`,w.value=r/n.value.length*100}if(!a.cover_url){const a=n.value.find(e=>e.picUrl);a&&(E.value="Ê≠£Âú®Êõ¥Êñ∞Â∞ÅÈù¢...",await(e=s,t={cover_url:a.picUrl},c({url:`/user/playlist/${e}`,method:"PUT",data:t})))}E.value="ËΩ¨Â≠òÊàêÂäüÔºÅ",uni.showToast({title:"ËΩ¨Â≠òÊàêÂäüÔºÅ",icon:"success"}),setTimeout(()=>{h.value=!1,uni.redirectTo({url:`/pages/playlist/detail?id=${s}&type=user`})},1500)}catch(a){h.value=!1,uni.showToast({title:a.message||"Êìç‰ΩúÂ§±Ë¥•",icon:"none"})}var e,t}else uni.showToast({title:"Ê≠åÂçï‰∏∫Á©∫",icon:"none"})},x=e=>{uni.showModal({title:"ÊèêÁ§∫",content:"Á°ÆÂÆöË¶Å‰ªéÊ≠åÂçï‰∏≠Âà†Èô§ËøôÈ¶ñÊ≠åÂêóÔºü",success:async a=>{if(a.confirm)try{await(l=i.value,o=e,c({url:`/user/playlist/${l}/remove_song/${o}`,method:"DELETE"})),uni.showToast({title:"Âà†Èô§ÊàêÂäü",icon:"success"}),n.value=n.value.filter(t=>t.id!==e)}catch(s){s&&"Ê≠åÊõ≤Âà†Èô§Â§±Ë¥•"===s.message?(t("warn","at pages/playlist/detail.vue:298","Backend returned 500 but deletion likely succeeded."),uni.showToast({title:"Âà†Èô§ÊàêÂäü",icon:"success"}),n.value=n.value.filter(t=>t.id!==e)):(t("error","at pages/playlist/detail.vue:302",s),uni.showToast({title:"ËØ∑Ê±ÇÂ§±Ë¥•",icon:"none"}))}var l,o}})},b=e=>{const t={id:e.id,name:e.name,ar:[{name:e.artistStr}],al:{name:e.albumStr,picUrl:e.picUrl}},a=n.value.map(e=>({id:e.id,name:e.name,ar:[{name:e.artistStr}],al:{name:e.albumStr,picUrl:e.picUrl}}));V.setPlaylist(a),V.setSongAndPlay(t)},B=()=>{n.value.length>0&&b(n.value[0])},T=()=>uni.navigateBack();return(t,a)=>{var s,i,c;return e.openBlock(),e.createElementBlock("view",{class:"detail-container"},[e.createElementVNode("image",{src:l.value.coverImgUrl||l.value.picUrl,class:"bg-image",mode:"aspectFill",style:e.normalizeStyle({transform:`translateY(${y.value}px)`})},null,12,["src"]),e.createElementVNode("view",{class:"bg-mask"}),e.createElementVNode("view",{class:"nav-bar",style:e.normalizeStyle({backgroundColor:`rgba(18, 18, 18, ${u.value})`})},[e.createElementVNode("view",{class:"back-btn",onClick:T},[e.createElementVNode("view",{class:"icon-back-arrow"})]),e.createElementVNode("text",{class:"nav-title",style:e.normalizeStyle({opacity:d.value})},e.toDisplayString(l.value.name),5)],4),e.createElementVNode("scroll-view",{"scroll-y":"",class:"scroll-content",onScroll:N},[e.createElementVNode("view",{class:"header-wrapper",style:e.normalizeStyle({transform:`scale(${m.value})`,opacity:p.value})},[e.createElementVNode("view",{class:"header-section"},[e.createElementVNode("view",{class:"cover-box"},[e.createElementVNode("image",{src:l.value.coverImgUrl||l.value.picUrl,class:"cover-image",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"play-count"},"‚ñ∑ "+e.toDisplayString((c=l.value.playCount||0,c>1e4?(c/1e4).toFixed(1)+"‰∏á":c)),1)]),e.createElementVNode("view",{class:"info-box"},[e.createElementVNode("view",null,[e.createElementVNode("text",{class:"playlist-name"},e.toDisplayString(l.value.name),1),e.createElementVNode("view",{class:"creator-info"},[e.createElementVNode("image",{src:null==(s=l.value.creator)?void 0:s.avatarUrl,class:"creator-avatar",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"creator-name"},e.toDisplayString(null==(i=l.value.creator)?void 0:i.nickname),1)])]),e.createElementVNode("view",{class:"desc-box",onClick:a[0]||(a[0]=e=>r.value=!0)},[e.createElementVNode("text",{class:"playlist-desc"},e.toDisplayString(l.value.description||"ÊöÇÊó†ÊèèËø∞"),1)])])])],4),"music"===o.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"action-bar"},[e.createElementVNode("view",{class:"action-btn-large",onClick:S},[e.createElementVNode("text",{class:"icon"},"‚ù§"),e.createElementVNode("text",{class:"text"},"‰∏ÄÈîÆËΩ¨Â≠òÂà∞ÊàëÁöÑÊ≠åÂçï")])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"action-bar-placeholder"})),e.createElementVNode("view",{class:"song-list-container"},[e.createElementVNode("view",{class:"play-all-header"},[e.createElementVNode("view",{class:"play-all-btn",onClick:B},[e.createElementVNode("text",{class:"play-icon"},"‚ñ∂"),e.createElementVNode("text",{class:"play-text"},"Êí≠ÊîæÂÖ®ÈÉ®"),e.createElementVNode("text",{class:"count-text"},"("+e.toDisplayString(n.value.length)+")",1)])]),e.createElementVNode("view",{class:"song-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"song-item",key:t.id,onClick:e=>b(t),style:e.normalizeStyle({animationDelay:.03*a+"s"})},[e.createElementVNode("view",{class:e.normalizeClass(["song-index",{"top-three":a<3}])},e.toDisplayString(a+1),3),e.createElementVNode("view",{class:"song-info"},[e.createElementVNode("text",{class:"song-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"song-detail"},e.toDisplayString(t.artistStr)+" - "+e.toDisplayString(t.albumStr),1)]),"user"===o.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"delete-btn",onClick:e.withModifiers(e=>x(t.id),["stop"])},"√ó",8,["onClick"])):e.createCommentVNode("",!0)],12,["onClick"]))),128))])])],32),h.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal-mask"},[e.createElementVNode("view",{class:"progress-modal"},[e.createElementVNode("text",{class:"progress-title"},"Ê≠£Âú®ËΩ¨Â≠ò..."),e.createElementVNode("view",{class:"progress-bar-bg"},[e.createElementVNode("view",{class:"progress-bar-fill",style:e.normalizeStyle({width:w.value+"%"})},[e.createElementVNode("view",{class:"progress-glow"})],4)]),e.createElementVNode("text",{class:"progress-info"},e.toDisplayString(E.value),1),e.createElementVNode("text",{class:"progress-percent"},e.toDisplayString(Math.floor(w.value))+"%",1)])])):e.createCommentVNode("",!0),r.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"desc-modal-mask",onClick:a[3]||(a[3]=e=>r.value=!1)},[e.createElementVNode("view",{class:"desc-modal-content",onClick:a[2]||(a[2]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("image",{src:l.value.coverImgUrl||l.value.picUrl,class:"desc-bg",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"desc-mask"}),e.createElementVNode("view",{class:"desc-text-wrapper"},[e.createElementVNode("text",{class:"desc-title"},e.toDisplayString(l.value.name),1),e.createElementVNode("scroll-view",{"scroll-y":"",class:"desc-scroll"},[e.createElementVNode("text",{class:"desc-full-text"},e.toDisplayString(l.value.description||"ÊöÇÊó†ÊèèËø∞"),1)])]),e.createElementVNode("view",{class:"desc-close",onClick:a[1]||(a[1]=e=>r.value=!1)},"√ó")])])):e.createCommentVNode("",!0),e.createVNode(k)])}}},[["__scopeId","data-v-eae2769e"]]),C=N({__name:"login",setup(a){const l=e.ref(!0),n=e.ref(""),o=e.ref(""),s=e.ref("");e.onMounted(()=>{const e=uni.getStorageSync("loginHistory");e&&(n.value=e.username||"",o.value=e.password||"")});const i=async()=>{if(n.value&&o.value){uni.showLoading({title:"Â§ÑÁêÜ‰∏≠..."});try{if(l.value){const t=await(e={username:n.value,password:o.value},c({url:"/user/login",method:"POST",data:e}));if(200===t.code){await m.fetchUserInfo()?(uni.setStorageSync("loginHistory",{username:n.value,password:o.value}),uni.showToast({title:"ÁôªÂΩïÊàêÂäü",icon:"success"}),setTimeout(()=>{uni.switchTab({url:"/pages/my/my"})},1e3)):uni.showToast({title:"Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•",icon:"none"})}else uni.showToast({title:t.message||"ÁôªÂΩïÂ§±Ë¥•",icon:"none"})}else{const e=await(e=>c({url:"/user/register",method:"POST",data:e}))({username:n.value,password:o.value,confirm_password:s.value});200===e.code?(uni.showToast({title:"Ê≥®ÂÜåÊàêÂäüÔºåËØ∑ÁôªÂΩï",icon:"success"}),l.value=!0):uni.showToast({title:e.message||"Ê≥®ÂÜåÂ§±Ë¥•",icon:"none"})}}catch(a){t("error","at pages/login/login.vue:82",a)}finally{uni.hideLoading()}var e}else uni.showToast({title:"ËØ∑Â°´ÂÜôÂÆåÊï¥",icon:"none"})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"login-container"},[e.createElementVNode("h1",{class:"title"},e.toDisplayString(l.value?"ÁôªÂΩï":"Ê≥®ÂÜå"),1),e.createElementVNode("view",{class:"input-group"},[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),placeholder:"ËØ∑ËæìÂÖ•Áî®Êà∑Âêç",class:"input-field"},null,512),[[e.vModelText,n.value]]),e.withDirectives(e.createElementVNode("input",{type:"password","onUpdate:modelValue":a[1]||(a[1]=e=>o.value=e),placeholder:"ËØ∑ËæìÂÖ•ÂØÜÁ†Å",class:"input-field"},null,512),[[e.vModelText,o.value]]),l.value?e.createCommentVNode("",!0):e.withDirectives((e.openBlock(),e.createElementBlock("input",{key:0,type:"password","onUpdate:modelValue":a[2]||(a[2]=e=>s.value=e),placeholder:"ËØ∑Á°ÆËÆ§ÂØÜÁ†Å",class:"input-field"},null,512)),[[e.vModelText,s.value]])]),e.createElementVNode("button",{class:"submit-btn",onClick:i},e.toDisplayString(l.value?"Áôª ÂΩï":"Ê≥® ÂÜå"),1),e.createElementVNode("view",{class:"switch-mode"},[e.createElementVNode("text",{onClick:a[3]||(a[3]=e=>l.value=!l.value)},e.toDisplayString(l.value?"ËøòÊ≤°ÊúâË¥¶Âè∑ÔºüÂéªÊ≥®ÂÜå":"Â∑≤ÊúâË¥¶Âè∑ÔºüÂéªÁôªÂΩï"),1)])]))}},[["__scopeId","data-v-52ec0bd7"]]),_=N({__name:"search",setup(a){const l=e.ref(""),n=e.ref([]),o=e.ref(!1),s=e.ref(!1),i=e.ref([]),r=e.ref(["Âë®Êù∞‰º¶","ÈôàÂ•ïËøÖ","Êûó‰øäÊù∞","Taylor Swift","golden hour","ÁîµÂ≠ê","Á∫ØÈü≥‰πê"]);e.onMounted(()=>{const e=uni.getStorageSync("searchHistory");e&&(i.value=e)});const u=()=>uni.navigateBack(),d=()=>{""===l.value&&(s.value=!1)},m=()=>{l.value="",s.value=!1},p=async()=>{const e=l.value.trim();if(e){o.value=!0,s.value=!0,n.value=[];try{const t=await(a={name:e},c({url:"/music/search",method:"GET",data:a}));200===t.code&&t.result&&t.result.songs&&(n.value=t.result.songs),g(e)}catch(i){t("error","at pages/search/search.vue:145",i)}finally{o.value=!1}var a}},v=e=>{l.value=e,p()},g=e=>{const t=i.value.indexOf(e);-1!==t&&i.value.splice(t,1),i.value.unshift(e),i.value.length>10&&i.value.pop(),uni.setStorageSync("searchHistory",i.value)},y=()=>{uni.showModal({title:"ÊèêÁ§∫",content:"Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊêúÁ¥¢ÂéÜÂè≤ÂêóÔºü",success:e=>{e.confirm&&(i.value=[],uni.removeStorageSync("searchHistory"))}})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"search-container"},[e.createElementVNode("view",{class:"bg-gradient"}),e.createElementVNode("view",{class:"bg-noise"}),e.createElementVNode("view",{class:"search-header"},[e.createElementVNode("view",{class:"input-wrapper"},[e.createElementVNode("text",{class:"search-icon"},"üîç"),e.withDirectives(e.createElementVNode("input",{class:"search-input",type:"text","confirm-type":"search","onUpdate:modelValue":a[0]||(a[0]=e=>l.value=e),placeholder:"ÊêúÁ¥¢Ê≠åÊõ≤„ÄÅÊ≠åÊâã",focus:"",onConfirm:p,onInput:d},null,544),[[e.vModelText,l.value]]),l.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"clear-icon",onClick:m},"√ó")):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"input-glow"})]),e.createElementVNode("text",{class:"cancel-btn",onClick:u},"ÂèñÊ∂à")]),s.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[o.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"status-text"},[e.createElementVNode("view",{class:"loading-dot"}),e.createElementVNode("view",{class:"loading-dot"}),e.createElementVNode("view",{class:"loading-dot"})])):e.createCommentVNode("",!0),o.value||0!==n.value.length?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:1,class:"status-text"},"Êú™ÊâæÂà∞Áõ∏ÂÖ≥Ê≠åÊõ≤")),n.value.length>0?(e.openBlock(),e.createElementBlock("scroll-view",{key:2,"scroll-y":"",class:"result-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"song-item",key:t.id,onClick:e=>(e=>{const t={id:e.id,name:e.name,ar:e.artists,al:e.album};V.setPlaylist(n.value),V.setSongAndPlay(t)})(t),style:e.normalizeStyle({animationDelay:.05*a+"s"})},[e.createElementVNode("view",{class:"song-index"},e.toDisplayString(String(a+1).padStart(2,"0")),1),e.createElementVNode("view",{class:"song-info"},[e.createElementVNode("text",{class:"song-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"song-detail"},e.toDisplayString(t.artists.map(e=>e.name).join("/"))+" - "+e.toDisplayString(t.album.name),1)]),e.createElementVNode("view",{class:"action-icon"},"‚ñ∂")],12,["onClick"]))),128))])):e.createCommentVNode("",!0)],64)):(e.openBlock(),e.createElementBlock("view",{key:0,class:"pre-search-content"},[e.createElementVNode("view",{class:"hot-search"},[e.createElementVNode("h3",{class:"section-title"},"ÁÉ≠Èó®ÊêúÁ¥¢"),e.createElementVNode("view",{class:"tag-cloud"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,(t,a)=>(e.openBlock(),e.createElementBlock("text",{class:"tag",key:t,onClick:e=>v(t),style:e.normalizeStyle({animationDelay:.05*a+"s"})},e.toDisplayString(t),13,["onClick"]))),128))])]),i.value.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"search-history"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("h3",{class:"section-title"},"ÊêúÁ¥¢ÂéÜÂè≤"),e.createElementVNode("text",{class:"clear-history",onClick:y},"Ê∏ÖÁ©∫")]),e.createElementVNode("view",{class:"history-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"history-item",key:a,onClick:e=>v(t),style:e.normalizeStyle({animationDelay:.05*a+"s"})},[e.createElementVNode("view",{class:"history-icon"},"üïí"),e.createElementVNode("text",{class:"history-text"},e.toDisplayString(t),1),e.createElementVNode("text",{class:"delete-item",onClick:e.withModifiers(e=>(e=>{i.value.splice(e,1),uni.setStorageSync("searchHistory",i.value)})(a),["stop"])},"√ó",8,["onClick"])],12,["onClick"]))),128))])])):e.createCommentVNode("",!0)])),e.createVNode(k)]))}},[["__scopeId","data-v-08f2a9a3"]]),I=N({__name:"player",setup(a){const n=e.ref(0),o=e.ref([]),s=e.ref(0),r=e.ref("");let u=!1;const d=e.ref("/static/default-avatar.png"),v=e.ref(!1),y=e.ref([]),h=e.ref(!1);let w=null;const E=async e=>{var a;if(!e||!e.id)return;const l=(null==(a=e.al)?void 0:a.picUrl)||e.cover_url;var n;if(l)d.value=l;else try{const t=await(n=e.id,c({url:`/music/song/cover/${n}`,method:"GET"}));t.data&&t.data.picUrl&&(d.value=t.data.picUrl,V.currentSong&&V.currentSong.id===e.id&&(V.currentSong.al||(V.currentSong.al={}),V.currentSong.al.picUrl=t.data.picUrl))}catch(o){t("error","at pages/player/player.vue:178","Fetch cover failed:",o)}},N=async e=>{var a,l,n,s;if(e){o.value=[],r.value="";try{const t=await(i=e,c({url:`/music/song/lyric/${i}`,method:"GET"}));let u="";(null==(a=null==t?void 0:t.data)?void 0:a.lrc)?u=t.data.lrc:(null==t?void 0:t.lrc)?u=t.lrc:(null==(l=null==t?void 0:t.lrc)?void 0:l.lyric)?u=t.lrc.lyric:(null==(s=null==(n=null==t?void 0:t.data)?void 0:n.lrc)?void 0:s.lyric)&&(u=t.data.lrc.lyric),"string"!=typeof u&&(u=JSON.stringify(u),"{}"!==u&&"null"!==u||(u="")),u?o.value=k(u):r.value="ÊöÇÊó†Ê≠åËØç"}catch(u){t("error","at pages/player/player.vue:214","Failed to fetch lyric:",u),r.value="Ê≠åËØçÂä†ËΩΩÂ§±Ë¥•"}var i}},k=e=>{if(!e)return[];const t=e.split(/[\n\r]+/),a=[],l=/\[(\d{1,2}):(\d{1,2})(\.(\d{1,3}))?\](.*)/;for(const n of t){const e=n.match(l);if(e){const t=60*parseInt(e[1])+parseInt(e[2])+(e[4]?parseFloat("0."+e[4]):0),l=e[5].trim();l&&a.push({time:t,text:l})}}return a},f=e.computed(()=>u?S.value:V.duration>0?V.currentTime/V.duration*100:0);let S=0;const x=e=>{u=!0,h.value=!0,S=e.detail.value},b=e=>{const t=e.detail.value/100*V.duration;V.seek(t),u=!1,B()},B=()=>{w&&clearTimeout(w),w=setTimeout(()=>{h.value=!1},2e3)};let T=null;l(()=>{const t=V.currentSong;N(null==t?void 0:t.id),E(t),T=e.watch(()=>V.currentTime,e=>{if(u||0===o.value.length||h.value)return;let t=-1;for(let a=0;a<o.value.length;a++)if(o.value[a].time>e){t=a-1;break}-1===t&&o.value.length>0&&e>o.value[o.value.length-1].time&&(t=o.value.length-1),t<0&&(t=0),s.value!==t&&(s.value=t)})}),i(()=>{T&&T()}),e.watch(()=>{var e;return null==(e=V.currentSong)?void 0:e.id},(e,t)=>{e&&e!==t&&(N(e),E(V.currentSong))});const C=()=>{V.isPlaying?V.pause():V.play()},_=()=>uni.navigateBack(),I=(e=0)=>{const t=Math.floor(e/60),a=Math.floor(e%60);return`${String(t).padStart(2,"0")}:${String(a).padStart(2,"0")}`},P=async()=>{if(!m.isLoggedIn)return uni.showToast({title:"ËØ∑ÂÖàÁôªÂΩï",icon:"none"}),void setTimeout(()=>uni.navigateTo({url:"/pages/login/login"}),1e3);uni.showLoading({title:"Âä†ËΩΩÊ≠åÂçï..."});try{const e=await p();200===e.code&&e.playlists?(y.value=e.playlists,v.value=!0):uni.showToast({title:"Ëé∑ÂèñÊ≠åÂçïÂ§±Ë¥•",icon:"none"})}catch(e){t("error","at pages/player/player.vue:346",e)}finally{uni.hideLoading()}};return(a,l)=>{var i,c;return e.openBlock(),e.createElementBlock("view",{class:"player-container"},[e.createElementVNode("image",{src:d.value,class:"bg-image",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"bg-mask"}),e.createElementVNode("view",{class:"bg-noise"}),e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"back-btn",onClick:_},[e.createElementVNode("view",{class:"icon-chevron-down"})]),e.createElementVNode("view",{class:"title-area"},[e.createElementVNode("text",{class:"song-title"},e.toDisplayString((null==(i=e.unref(V).currentSong)?void 0:i.name)||"Êú™Áü•Ê≠åÊõ≤"),1),e.createElementVNode("text",{class:"singer-name"},e.toDisplayString((c=e.unref(V).currentSong,c?c.ar?c.ar.map(e=>e.name).join("/"):c.artists?c.artists.map(e=>e.name).join("/"):c.artist?c.artist:"Êú™Áü•Ê≠åÊâã":"")),1)]),e.createElementVNode("view",{class:"right-placeholder"})]),e.createElementVNode("swiper",{class:"content-swiper",current:n.value,onChange:l[1]||(l[1]=e=>n.value=e.detail.current),duration:"400"},[e.createElementVNode("swiper-item",null,[e.createElementVNode("view",{class:"cover-wrapper"},[e.createElementVNode("view",{class:e.normalizeClass(["cover-glow",{playing:e.unref(V).isPlaying}])},null,2),e.createElementVNode("view",{class:e.normalizeClass(["cover-disc",{playing:e.unref(V).isPlaying}])},[e.createElementVNode("image",{src:d.value,class:"cover-image",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"disc-center"})],2)])]),e.createElementVNode("swiper-item",null,[e.createElementVNode("scroll-view",{"scroll-y":"",class:"lyric-scroll","scroll-into-view":`lyric-line-${s.value}`,"scroll-with-animation":"",onTouchstart:l[0]||(l[0]=e=>h.value=!0),onTouchend:B},[0===o.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"lyric-line no-lyric"},e.toDisplayString(r.value||"Á∫ØÈü≥‰πêÔºåËØ∑Ê¨£Ëµè"),1)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,(t,a)=>(e.openBlock(),e.createElementBlock("view",{id:`lyric-line-${a}`,class:e.normalizeClass(["lyric-line",{active:a===s.value}]),key:a,onClick:e=>{var a;(a=t.time)>=0&&(V.seek(a),V.isPlaying||V.play(),h.value=!1,uni.showToast({title:"Â∑≤Ë∑≥ËΩ¨",icon:"none",duration:1e3}))}},e.toDisplayString(t.text),11,["id","onClick"]))),128))],40,["scroll-into-view"])])],40,["current"]),e.createElementVNode("view",{class:"footer-area"},[e.createElementVNode("view",{class:"progress-container"},[e.createElementVNode("text",{class:"time-text"},e.toDisplayString(I(e.unref(V).currentTime)),1),e.createElementVNode("view",{class:"slider-wrapper"},[e.createElementVNode("slider",{class:"custom-slider",value:f.value,onChanging:x,onChange:b,activeColor:"#00f2ea",backgroundColor:"rgba(255,255,255,0.15)","block-size":"16","block-color":"#fff"},null,40,["value"])]),e.createElementVNode("text",{class:"time-text"},e.toDisplayString(I(e.unref(V).duration)),1)]),e.createElementVNode("view",{class:"controls-grid"},[e.createElementVNode("view",{class:"ctrl-btn mode-btn",onClick:l[2]||(l[2]=t=>e.unref(V).togglePlayMode())},[e.createElementVNode("view",{class:e.normalizeClass(["icon-mode",e.unref(V).playMode])},null,2)]),e.createElementVNode("view",{class:"ctrl-btn prev-btn",onClick:l[3]||(l[3]=t=>e.unref(V).playPrev())},[e.createElementVNode("view",{class:"icon-prev"})]),e.createElementVNode("view",{class:"play-pause-wrapper",onClick:C},[e.createElementVNode("view",{class:e.normalizeClass(["play-pause-btn",{playing:e.unref(V).isPlaying}])},[e.createElementVNode("view",{class:e.normalizeClass(["icon-play-pause",{paused:!e.unref(V).isPlaying}])},null,2)],2)]),e.createElementVNode("view",{class:"ctrl-btn next-btn",onClick:l[4]||(l[4]=t=>e.unref(V).playNext())},[e.createElementVNode("view",{class:"icon-next"})]),e.createElementVNode("view",{class:"ctrl-btn fav-btn",onClick:P},[e.createElementVNode("view",{class:"icon-heart"})])])]),v.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal-mask",onClick:l[6]||(l[6]=e=>v.value=!1)},[e.createElementVNode("view",{class:"modal-content",onClick:l[5]||(l[5]=e.withModifiers(()=>{},["stop"]))},[e.createElementVNode("text",{class:"modal-title"},"Êî∂ËóèÂà∞Ê≠åÂçï"),e.createElementVNode("scroll-view",{"scroll-y":"",class:"playlist-scroll"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(y.value,a=>(e.openBlock(),e.createElementBlock("view",{class:"playlist-item",key:a.id,onClick:e=>(async e=>{uni.showLoading({title:"Ê∑ªÂä†‰∏≠..."});try{const t=await g(e,{song_id:V.currentSong.id});200===t.code?(uni.showToast({title:"Â∑≤Êî∂Ëóè",icon:"success"}),v.value=!1):uni.showToast({title:t.message||"Êî∂ËóèÂ§±Ë¥•",icon:"none"})}catch(a){t("error","at pages/player/player.vue:363",a),uni.showToast({title:"ËØ∑Ê±ÇÂ§±Ë¥•",icon:"none"})}finally{uni.hideLoading()}})(a.id)},[e.createElementVNode("image",{src:a.cover_url||"/static/default-avatar.png",class:"pl-cover",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"pl-info"},[e.createElementVNode("text",{class:"pl-name"},e.toDisplayString(a.name),1),e.createElementVNode("text",{class:"pl-count"},e.toDisplayString(a.song_count||0)+" È¶ñ",1)])],8,["onClick"]))),128))])])])):e.createCommentVNode("",!0)])}}},[["__scopeId","data-v-7e83ea8b"]]),P=N({__name:"history",setup(a){const n=e.ref([]),o=e.ref(!1);l(()=>{i()});const s=()=>uni.navigateBack(),i=async()=>{o.value=!0;try{const t=await(e={page:1,limit:100},c({url:"/user/get_history",method:"GET",data:e}));200===t.code&&t.history&&(n.value=t.history.map(e=>({id:e.song_id,name:e.name,artist:e.artist,album:e.album,play_time:e.play_time,ar:[{name:e.artist}],al:{name:e.album,picUrl:e.cover_url||""}})))}catch(a){t("error","at pages/my/history.vue:83",a),uni.showToast({title:"Ëé∑ÂèñÂéÜÂè≤Â§±Ë¥•",icon:"none"})}finally{o.value=!1}var e},r=e=>{if(!e)return"";const t=e.replace(/-/g,"/"),a=new Date(t),l=(new Date).getTime()-a.getTime(),n=Math.floor(l/6e4);if(n<1)return"ÂàöÂàö";if(n<60)return`${n}ÂàÜÈíüÂâç`;const o=Math.floor(n/60);if(o<24)return`${o}Â∞èÊó∂Ââç`;const s=Math.floor(o/24);return s<7?`${s}Â§©Ââç`:`${a.getMonth()+1}/${a.getDate()}`},u=e=>{V.setPlaylist(n.value),V.setSongAndPlay(e)},d=()=>{n.value.length>0&&u(n.value[0])};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"history-container"},[e.createElementVNode("view",{class:"bg-noise"}),e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"back-btn",onClick:s},[e.createElementVNode("view",{class:"icon-back"})]),e.createElementVNode("text",{class:"nav-title"},"Êí≠ÊîæÂéÜÂè≤")]),e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"title-group"},[e.createElementVNode("text",{class:"main-title"},"HISTORY"),e.createElementVNode("text",{class:"sub-title"},"ÂÖ± "+e.toDisplayString(n.value.length)+" È¶ñÊ≠åÊõ≤",1)]),e.createElementVNode("view",{class:"play-all-btn",onClick:d},[e.createElementVNode("view",{class:"play-icon"},"‚ñ∂"),e.createElementVNode("text",null,"Êí≠ÊîæÂÖ®ÈÉ®")])]),e.createElementVNode("scroll-view",{"scroll-y":"",class:"song-list"},[o.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-text"},"Âä†ËΩΩ‰∏≠...")):0===n.value.length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-text"},"ÊöÇÊó†Êí≠ÊîæËÆ∞ÂΩï")):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"song-card",key:t.id,onClick:e=>u(t),style:e.normalizeStyle({animationDelay:.05*a+"s"})},[e.createElementVNode("view",{class:"card-bg"}),e.createElementVNode("view",{class:"song-index"},e.toDisplayString(String(a+1).padStart(2,"0")),1),e.createElementVNode("view",{class:"song-info"},[e.createElementVNode("text",{class:"song-name"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"song-detail"},e.toDisplayString(t.artist)+" - "+e.toDisplayString(t.album),1)]),e.createElementVNode("text",{class:"play-time"},e.toDisplayString(r(t.play_time)),1)],12,["onClick"]))),128))]),e.createVNode(k)]))}},[["__scopeId","data-v-cbdee638"]]);__definePage("pages/index/index",f),__definePage("pages/rank/rank",S),__definePage("pages/parse/parse",x),__definePage("pages/my/my",b),__definePage("pages/about/about",B),__definePage("pages/playlist/detail",T),__definePage("pages/login/login",C),__definePage("pages/search/search",_),__definePage("pages/player/player",I),__definePage("pages/my/history",P);const D={__name:"App",setup:a=>(o(()=>{t("log","at App.vue:13","App Launch");uni.getStorageSync("session_cookie")&&(t("log","at App.vue:16","Found cookie, attempting to fetch user info..."),m.fetchUserInfo())}),l(()=>{t("log","at App.vue:22","App Show")}),n(()=>{t("log","at App.vue:26","App Hide")}),(t,a)=>{const l=e.resolveComponent("router-view");return e.openBlock(),e.createElementBlock("view",{class:"app-container"},[e.createVNode(l)])})};const{app:U,Vuex:A,Pinia:M}={app:e.createVueApp(D)};uni.Vuex=A,uni.Pinia=M,U.provide("__globalStyles",__uniConfig.styles),U._component.mpType="app",U._component.render=()=>{},U.mount("#app")}(Vue);
